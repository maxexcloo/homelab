[tools]
1password = "latest"
opentofu = "latest"
sops = "latest"

[env]
TF_CLI_ARGS_init = "-upgrade"
TF_CLI_ARGS_plan = "-compact-warnings -parallelism=20"
TF_CLI_ARGS_apply = "-compact-warnings -parallelism=20"

# Setup
[tasks.setup]
description = "Initial project setup"
run = """
# Setting up project...
if [[ ! -f .mise.local.toml ]]; then
  echo "ðŸ“„ Creating .mise.local.toml template..."
  cp .mise.local.toml.default .mise.local.toml
  echo "âœ… Created .mise.local.toml - please add your tokens"
  exit 1
fi
"""

[tasks.init]
description = "Initialize OpenTofu"
run = "tofu init"

# Development
[tasks.check]
description = "Format and validate"
depends = ["fmt", "validate"]

[tasks.fmt]
description = "Format all files"
run = "tofu fmt -recursive"

[tasks.validate]
description = "Validate configurations"
run = "tofu validate"

# Deployment
[tasks.refresh]
description = "Check for configuration drift"
run = "tofu refresh"

[tasks.plan]
description = "Plan all changes"
run = "tofu plan"

[tasks.apply]
description = "Apply all changes"
run = """
# Apply all changes
if [[ -n "$CI" ]] || [[ "$MISE_YES" == "true" ]]; then
  tofu apply -auto-approve
else
  tofu apply
fi
"""
